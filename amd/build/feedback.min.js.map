{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Helper function to build JS vendor path.\n *\n * @param {string} path\n * @returns {string}\n */\nconst vendorJSURL = function(path) {\n    return M.cfg.wwwroot + '/report/myfeedback/vendor/js/' + path + '.min';\n};\n\nrequire.config({\n    paths: {\n        'datatables.net': vendorJSURL('jquery.dataTables'),\n        'datatables.net-buttons': vendorJSURL('dataTables.buttons'),\n        'datatables.net-colreorder': vendorJSURL('dataTables.colReorder'),\n        'datatables.net-fixedheader': vendorJSURL('dataTables.fixedHeader'),\n        'datatables.net-responsive': vendorJSURL('dataTables.responsive'),\n    },\n});\n\ndefine([\n    'jquery',\n    'datatables.net',\n    'datatables.net-buttons',\n    'datatables.net-colreorder',\n    'datatables.net-fixedheader',\n    'datatables.net-responsive',\n], function($) {\n\n    return {\n        init: function() {\n            /* Plugin API method to determine is a column is sortable */\n            $.fn.dataTable.Api.register( 'column().searchable()', function () {\n                var ctx = this.context[0];\n                return ctx.aoColumns[this[0]].bSearchable;\n            });\n\n            $(document).ready( function () {\n                const $feedbackcomments = $('#feedbackcomments');\n\n                var filterCells = $('thead tr:eq(1) td');\n\n                // Create the DataTable\n                var feedbacktable = $feedbackcomments.DataTable({\n                    dom: 'RlfBrtip',\n                    fixedHeader: true,\n                    pageLength: 25,\n                    orderCellsTop: true,\n                    columnDefs: [\n                        {\n                            targets: [ 5, 6, 7 ],\n                            searchable: false,\n                            orderable:  false\n                        }\n                    ],\n                    order: [[ 3, 'desc' ]],\n                    buttons: ['colvis'],\n                    stateSave: true,\n                    stateSaveCallback: function(settings,data) {\n                        localStorage.setItem('Feedback', JSON.stringify(data));\n                    },\n                    stateLoadCallback: function() {\n                        return JSON.parse(localStorage.getItem('Feedback'));\n                    },\n                    responsive: true,\n                    colReorder: true,\n                } );\n\n                // Add filtering.\n                feedbacktable.columns().every( async function () {\n                    if ( this.searchable() ) {\n                        var that = this;\n\n                        // Create the `select` element\n                        var select = $('<select><option value=\\\"\\\"></option></select>')\n                            .appendTo(\n                                filterCells.eq( feedbacktable.colReorder.transpose( this.index(), 'toOriginal' ) )\n                            )\n                            .on( 'change', function() {\n                                that\n                                    .search($(this).val())\n                                    .draw();\n                            } );\n\n                        // Add data\n                        this\n                            .data()\n                            .sort()\n                            .unique()\n                            .each( function(d) {\n                                select.append($('<option>' + d + '</option>'));\n                            } );\n\n                        // Restore state saved values\n                        var state = this.state.loaded();\n                        if ( state ) {\n                            var val = state.columns[this.index()];\n                            select.val( val.search.search );\n                        }\n                    }\n                });\n\n                // When button is clicked to reset table.\n                $('#ftableDestroy').on('click', function () {\n                    feedbacktable.colReorder.reset();\n                    feedbacktable.destroy(false);\n                    $('thead select').val('').change();\n                    feedbacktable.state.clear();\n                    location.reload();\n                } );\n\n                $('#exportexcel').on('click', function() {\n                    window.location.href= 'export.php';\n                });\n\n                $('#reportPrint').on('click', function () {\n                    print();\n                });\n\n                $feedbackcomments.on('click', '.addnote', function () {\n                    var gradeid = $(this).data('gid');\n                    var instn = $(this).data('inst');\n                    $('#gradeid').val(gradeid);\n                    $('#instance1').val(instn);\n                    $('#user_id').val($(this).data('uid'));\n                    $('#notename').val($('#note-val'+gradeid+instn).text());\n                    if ($('#Abs2').modal) {\n                        $('#Abs2').modal('show');\n                    }\n                });\n\n                $feedbackcomments.on('click', '.addfeedback', function () {\n                    var gradeid2 = $(this).data('gid');\n                    var instn = $(this).data('inst');\n                    $('#gradeid2').val(gradeid2);\n                    $('#instance').val(instn);\n                    $('#user_id2').val($(this).data('uid'));\n                    $('#feedname').val($('#feed-val'+gradeid2+instn).text());\n                    if ($('#Abs1').modal) {\n                        $('#Abs1').modal('show');\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["vendorJSURL","path","M","cfg","wwwroot","require","config","paths","define","$","init","fn","dataTable","Api","register","this","context","aoColumns","bSearchable","document","ready","$feedbackcomments","filterCells","feedbacktable","DataTable","dom","fixedHeader","pageLength","orderCellsTop","columnDefs","targets","searchable","orderable","order","buttons","stateSave","stateSaveCallback","settings","data","localStorage","setItem","JSON","stringify","stateLoadCallback","parse","getItem","responsive","colReorder","columns","every","that","select","appendTo","eq","transpose","index","on","search","val","draw","sort","unique","each","d","append","state","loaded","reset","destroy","change","clear","location","reload","window","href","print","gradeid","instn","text","modal","gradeid2"],"mappings":"2NAqBA,IAAMA,YAAc,SAASC,aAClBC,EAAEC,IAAIC,QAAU,gCAAkCH,KAAO,QAGpEI,QAAQC,OAAO,CACXC,MAAO,kBACeP,YAAY,8CACJA,YAAY,kDACTA,YAAY,sDACXA,YAAY,sDACbA,YAAY,4BAIjDQ,oCAAO,CACH,SACA,iBACA,yBACA,4BACA,6BACA,8BACD,SAASC,SAED,CACHC,KAAM,WAEFD,EAAEE,GAAGC,UAAUC,IAAIC,SAAU,yBAAyB,kBACxCC,KAAKC,QAAQ,GACZC,UAAUF,KAAK,IAAIG,eAGlCT,EAAEU,UAAUC,OAAO,kBACTC,kBAAoBZ,EAAE,qBAExBa,YAAcb,EAAE,qBAGhBc,cAAgBF,kBAAkBG,UAAU,CAC5CC,IAAK,WACLC,aAAa,EACbC,WAAY,GACZC,eAAe,EACfC,WAAY,CACR,CACIC,QAAS,CAAE,EAAG,EAAG,GACjBC,YAAY,EACZC,WAAY,IAGpBC,MAAO,CAAC,CAAE,EAAG,SACbC,QAAS,CAAC,UACVC,WAAW,EACXC,kBAAmB,SAASC,SAASC,MACjCC,aAAaC,QAAQ,WAAYC,KAAKC,UAAUJ,QAEpDK,kBAAmB,kBACRF,KAAKG,MAAML,aAAaM,QAAQ,cAE3CC,YAAY,EACZC,YAAY,IAIhBxB,cAAcyB,UAAUC,mCAAO,kJACtBlC,KAAKgB,eACFmB,KAAOnC,KAGPoC,OAAS1C,EAAE,+CACV2C,SACG9B,YAAY+B,GAAI9B,cAAcwB,WAAWO,UAAWvC,KAAKwC,QAAS,gBAErEC,GAAI,UAAU,WACXN,KACKO,OAAOhD,EAAEM,MAAM2C,OACfC,eAKRrB,OACAsB,OACAC,SACAC,MAAM,SAASC,GACZZ,OAAOa,OAAOvD,EAAE,WAAasD,EAAI,kBAIrCE,MAAQlD,KAAKkD,MAAMC,YAEfR,IAAMO,MAAMjB,QAAQjC,KAAKwC,SAC7BJ,OAAOO,IAAKA,IAAID,OAAOA,uXAMnChD,EAAE,kBAAkB+C,GAAG,SAAS,WAC5BjC,cAAcwB,WAAWoB,QACzB5C,cAAc6C,SAAQ,GACtB3D,EAAE,gBAAgBiD,IAAI,IAAIW,SAC1B9C,cAAc0C,MAAMK,QACpBC,SAASC,YAGb/D,EAAE,gBAAgB+C,GAAG,SAAS,WAC1BiB,OAAOF,SAASG,KAAM,gBAG1BjE,EAAE,gBAAgB+C,GAAG,SAAS,WAC1BmB,WAGJtD,kBAAkBmC,GAAG,QAAS,YAAY,eAClCoB,QAAUnE,EAAEM,MAAMuB,KAAK,OACvBuC,MAAQpE,EAAEM,MAAMuB,KAAK,QACzB7B,EAAE,YAAYiD,IAAIkB,SAClBnE,EAAE,cAAciD,IAAImB,OACpBpE,EAAE,YAAYiD,IAAIjD,EAAEM,MAAMuB,KAAK,QAC/B7B,EAAE,aAAaiD,IAAIjD,EAAE,YAAYmE,QAAQC,OAAOC,QAC5CrE,EAAE,SAASsE,OACXtE,EAAE,SAASsE,MAAM,WAIzB1D,kBAAkBmC,GAAG,QAAS,gBAAgB,eACtCwB,SAAWvE,EAAEM,MAAMuB,KAAK,OACxBuC,MAAQpE,EAAEM,MAAMuB,KAAK,QACzB7B,EAAE,aAAaiD,IAAIsB,UACnBvE,EAAE,aAAaiD,IAAImB,OACnBpE,EAAE,aAAaiD,IAAIjD,EAAEM,MAAMuB,KAAK,QAChC7B,EAAE,aAAaiD,IAAIjD,EAAE,YAAYuE,SAASH,OAAOC,QAC7CrE,EAAE,SAASsE,OACXtE,EAAE,SAASsE,MAAM"}